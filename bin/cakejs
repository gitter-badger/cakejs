FILEPATH=$(dirname $0)

TRANSPILE=1
while getopts ":c" opt; do
	case $opt in
		c)
			shift $((OPTIND-1))
			TRANSPILE=0
			;;
	esac
done

if [ "$1" = "test" ]; then
	shift $((OPTIND))
	if [ $TRANSPILE -eq 1 ]; then
		node $FILEPATH/transpiler.js $FILEPATH/test.js tests
	else
		node $FILEPATH/../dist/bin/test.js dist/tests
	fi
	exit $?
fi

if [ "$1" = "build" ]; then
	shift $((OPTIND))
	echo -n "Compiling config..."
	node $FILEPATH/transpiler.js $FILEPATH/compiler.js config dist
	echo "done"
	echo -n "Compiling src..."
	node $FILEPATH/transpiler.js $FILEPATH/compiler.js src dist
	echo "done"
	echo -n "Compiling tests..."
	node $FILEPATH/transpiler.js $FILEPATH/compiler.js tests dist
	echo "done"
	echo -n "Compiling bin..."
	cp -r bin dist/bin
	echo "done"
	echo -n "Compiling webroot..."
	cp -r webroot dist/webroot
	echo "done"
	exit $?
fi

if [ $TRANSPILE -eq 1 ]; then
	node $FILEPATH/transpiler.js $FILEPATH/cakejs.js config/bootstrap.js $@
else
	node $FILEPATH/../dist/bin/cakejs.js dist/config/bootstrap.js $@
fi
exit $?